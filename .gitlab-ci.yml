stages:
  - test
  - build
  - deploy

# ---------- Templates -------------

.template_export: &template_export
  stage: build
  image: mrminimal/godot-desktop-export:3.1.1
  script:
    - mkdir -p export/$TYPE/$PLATFORM
    - cd Scramble-$TYPE
    - godot -v --export $PLATFORM ../export/$TYPE/$PLATFORM/Scramble-$TYPE.x64
    - if ! test -f ../export/$TYPE/$PLATFORM/Scramble-$TYPE.x64; then exit 1; fi
  artifacts:
    name: Scramble-$TYPE-$CI_BUILD_REF
    paths:
      - export/$TYPE

# -------------- Jobs --------------

license-header:
  stage: test
  image: alpine
  script:
  - .gitlab/licenseHeaderCheck.sh .gitlab/license/LICENSE_HEADER

file-naming:
  stage: test
  image: alpine
  script:
  - apk update && apk add bash
  - ./.gitlab/fileNamingConventionCheck.sh

global-logging:
  stage: test
  image: alpine
  script:
  - apk update && apk add grep
  - ./.gitlab/scrambleLoggingCheck.sh

# Client

linux-client:
  <<: *template_export
  variables:
    TYPE: "client"
    PLATFORM: "linux"

mac-client:
  <<: *template_export
  variables:
    TYPE: "client"
    PLATFORM: "mac"

windows-client:
  <<: *template_export
  variables:
    TYPE: "client"
    PLATFORM: "windows"

# Server

linux-server:
  <<: *template_export
  variables:
    TYPE: "server"
    PLATFORM: "linux"

mac-server:
  <<: *template_export
  variables:
    TYPE: "server"
    PLATFORM: "mac"

windows-server:
  <<: *template_export
  variables:
    TYPE: "server"
    PLATFORM: "windows"

