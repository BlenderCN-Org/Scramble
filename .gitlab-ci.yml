stages:
  - test
  - build
  - deploy

# ---------- Templates -------------

.template_export: &template_export
  stage: build
  image: mrminimal/godot-desktop-export:3.1.1
  script:
    - mkdir -p export/$TYPE/$PLATFORM
    - cd Scramble-$TYPE
    - godot -v --export "$PLATFORM"   ../export/$TYPE/$PLATFORM/Scramble-$TYPE.x64
    - if ! test -f export/$TYPE/$PLATFORM/Scramble-$TYPE.x64; then exit 1; fi
  artifacts:
    name: Scramble-$TYPE-$CI_BUILD_REF
    paths:
      - export/$TYPE

.template_client_server: &template_client_server
  desktop-client-$PLATFORM:
    <<: *template_export
    variables:
      TYPE: "client"

  desktop-server-$PLATFORM:
    <<: *template_export
    variables:
      TYPE: "server"

# -------------- Jobs --------------

license-header:
  stage: test
  image: alpine
  script:
  - '.gitlab/licenseHeaderCheck.sh .gitlab/license/LICENSE_HEADER'

file-naming:
  stage: test
  image: alpine
  script:
  - 'apk update && apk add bash'
  - './.gitlab/fileNamingConventionCheck.sh'

global-logging:
  stage: test
  image: alpine
  script:
  - 'apk update && apk add grep'
  - './.gitlab/scrambleLoggingCheck.sh'

<<: *template_client_server
variables:
  PLATFORM: "linux"

<<: *template_client_server
variables:
  PLATFORM: "mac"

<<: *template_client_server
variables:
  PLATFORM: "windows"

